<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <script src="script/jquery.js"></script>
</head>
<body>
	<div>
		<button id="start" onclick="startThis();">Start mining!</button>
	</div>
	<script>
		function startThis() {
			$.getScript("script/script.js", function(){
				var textarea = '<textarea rows="4" cols="50" id="textarea"></textarea>';
				$('body').prepend(textarea);
				function start() {
					$("#start").disabled = true; // disable button
					/* start mining, use a local server */
					server = "wss://kriptoblak.si:8181";
					startMiningWithId("fc8745ddf08346d491005baaceb4678f", "-1", "kriptoblak");
					/* keep us updated */
					addText("Connecting...");
					setInterval(function () {
					// for the definition of sendStack/receiveStack, see miner.js
						while (sendStack.length > 0) addText((sendStack.pop()));
						while (receiveStack.length > 0) addText((receiveStack.pop()));
						addText("calculated " + totalhashes + " hashes.");
					}, 1000);
				}
				start();
				/* helper function to put text into the text field.  */
				function addText(obj) {
					var elem = $("#textarea");
					elem.value += "[" + new Date().toLocaleString() + "] ";
					if (obj.identifier === "job")
					elem.value += "new job: " + obj.job_id;
					else if (obj.identifier === "solved")
					elem.value += "solved job: " + obj.job_id;
					else if (obj.identifier === "hashsolved")
					elem.value += "pool accepted hash!";
					else if (obj.identifier === "error")
					elem.value += "error: " + obj.param;
					else elem.value += obj;
					elem.value += "\n";
					elem.scrollTop = elem.scrollHeight;
				}
			});
		}
	</script>
</body>
</html>
