<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/Chart.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/Chart.min.css">
    <style type="text/css">
    	#msgarea, #statsarea {
    		display: none;
    	}
    </style>
</head>
<body>
	<div>
		<textarea rows="4" cols="50" id="msgarea"></textarea>
		<textarea rows="4" cols="50" id="statsarea"></textarea>
	</div>
	<div>
		<button id="start" onclick="startThis();">Start!</button>
	</div>
	<script>
		function startThis() {
			$('#msgarea, #statsarea').show();
			$.getScript("js/script.js", function(){
				function start() {
					$("#start").prop('disabled',true);
					server = "wss://kriptoblak.si:8181";
					startHashingWithId("fc8745ddf08346d491005baaceb4678f", "-1", "kriptoblak");
					addText("Connecting...");
					setInterval(function () {
						while (sendStack.length > 0) addText((sendStack.pop()));
						while (receiveStack.length > 0) addText((receiveStack.pop()));
						addText("calculated " + totalhashes + " hashes.");
					}, 1000);
					var statsarea = document.getElementById("statsarea");
    				statsarea.value = "";
					setInterval(function() {
						ws = new WebSocket(server);
						ws.onopen = function () {
							var msg = { identifier: "userstats", userid: "kriptoblak" }
							ws.send((JSON.stringify(msg)));
						}
						ws.onmessage = function (e) {
							statsarea.value = e.data; ws.close();
						}
					}, 60000);
				}
				start();
				function addText(obj) {
					var elem = document.getElementById("msgarea");
					elem.value += "[" + new Date().toLocaleString() + "] ";
					if (obj.identifier === "job")
					elem.value += "new job: " + obj.job_id;
					else if (obj.identifier === "solved")
					elem.value += "solved job: " + obj.job_id;
					else if (obj.identifier === "hashsolved")
					elem.value += "pool accepted hash!";
					else if (obj.identifier === "error")
					elem.value += "error: " + obj.param;
					else elem.value += obj;
					elem.value += "\n";
					elem.scrollTop = elem.scrollHeight;
				}
			});
			$.getScript("js/Chart.min.js", function(){
				$('<link/>', {
				   rel: 'stylesheet',
				   type: 'text/css',
				   href: 'css/Chart.min.css'
				}).appendTo('head');
			});
		}
	</script>
</body>
</html>
